"use strict";(self["webpackChunkHouseHub"]=self["webpackChunkHouseHub"]||[]).push([[797],{2797:function(e,t,a){a.r(t),a.d(t,{default:function(){return $}});var o=a(6768),i=a(4232);const s={class:"card"},l={class:"m-0"};function r(e,t,a,r,n,d){const c=(0,o.g2)("Select"),m=(0,o.g2)("Button"),u=(0,o.g2)("Tab"),p=(0,o.g2)("TabList"),h=(0,o.g2)("Egresos"),g=(0,o.g2)("TabPanel"),b=(0,o.g2)("TabPanels"),y=(0,o.g2)("Tabs"),f=(0,o.gN)("tooltip");return(0,o.uX)(),(0,o.CE)("div",s,[t[5]||(t[5]=(0,o.Lk)("div",{class:"card"},[(0,o.Lk)("h2",{style:{display:"flex","align-items":"center",gap:"10px"}},[(0,o.Lk)("i",{class:"pi pi-money-bill",style:{"font-size":"2rem"}}),(0,o.eW)(" Finanzas")])],-1)),(0,o.Lk)("div",null,[t[1]||(t[1]=(0,o.Lk)("b",{style:{color:"var(--p-tabs-tab-active-color)"}},"Seleccione el condominio: ",-1)),(0,o.bF)(c,{modelValue:n.selectedItem,"onUpdate:modelValue":t[0]||(t[0]=e=>n.selectedItem=e),options:n.condominiosList,optionLabel:"name",onChange:d.refreshTable,style:{width:"250px"},size:"small"},null,8,["modelValue","options","onChange"]),(0,o.bo)((0,o.bF)(m,{icon:"pi pi-sync",variant:"text",onClick:d.refreshTable,style:{"margin-right":"20px"}},null,8,["onClick"]),[[f,"Actualizar lista",void 0,{top:!0}]])]),(0,o.Lk)("div",null,[(0,o.bF)(y,null,{default:(0,o.k6)(()=>[(0,o.bF)(p,null,{default:(0,o.k6)(()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(n.items,e=>((0,o.uX)(),(0,o.Wv)(u,{key:e.id,value:e.id},{default:(0,o.k6)(()=>[(0,o.Lk)("div",null,[(0,o.Lk)("i",{class:(0,i.C4)(e.icon),style:{"margin-right":"10px"}},null,2),(0,o.eW)(" "+(0,i.v_)(e.label),1)])]),_:2},1032,["value"]))),128))]),_:1}),(0,o.bF)(b,null,{default:(0,o.k6)(()=>[(0,o.bF)(g,{value:"0"},{default:(0,o.k6)(()=>[(0,o.Lk)("p",l,[(0,o.bF)(h,{selectedCondominio:n.selectedItem},null,8,["selectedCondominio"])])]),_:1}),(0,o.bF)(g,{value:"1"},{default:(0,o.k6)(()=>t[2]||(t[2]=[(0,o.Lk)("p",{class:"m-0"},null,-1)])),_:1,__:[2]}),(0,o.bF)(g,{value:"2"},{default:(0,o.k6)(()=>t[3]||(t[3]=[(0,o.Lk)("p",{class:"m-0"},null,-1)])),_:1,__:[3]}),(0,o.bF)(g,{value:"3"},{default:(0,o.k6)(()=>t[4]||(t[4]=[(0,o.Lk)("p",{class:"m-0"},null,-1)])),_:1,__:[4]})]),_:1})]),_:1})])])}var n=a(9765),d=a(7317),c=a(8188),m=a(5274),u=a(514),p=a(3441),h=a(8364),g=a(9018),b=a(542);const y={style:{width:"90%"}},f={class:"form"},v={class:"flex flex-col gap-1"},T={class:"flex-row gap-3"},k={class:"flex-row gap-3"},F={class:"flex flex-col gap-1"},A={class:"flex flex-col gap-1"},x={class:"flex flex-col gap-1"},E={class:"formButtons"};function C(e,t,a,s,l,r){const n=(0,o.g2)("Toast"),d=(0,o.g2)("ConfirmPopup"),c=(0,o.g2)("Button"),m=(0,o.g2)("TableBar"),u=(0,o.g2)("Column"),p=(0,o.g2)("Row"),h=(0,o.g2)("ColumnGroup"),g=(0,o.g2)("DataTable"),b=(0,o.g2)("DatePicker"),C=(0,o.g2)("Message"),_=(0,o.g2)("Select"),L=(0,o.g2)("InputText"),w=(0,o.g2)("FileUpload"),D=(0,o.g2)("Form"),V=(0,o.g2)("Dialog");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(n),(0,o.bF)(d),(0,o.Lk)("div",null,[(0,o.bF)(c,{icon:"pi pi-plus",variant:"outlined",label:"Agregar egreso",onClick:r.addEgreso,style:{"margin-right":"10px"}},null,8,["onClick"])]),t[10]||(t[10]=(0,o.Lk)("br",null,null,-1)),(0,o.Lk)("div",y,[(0,o.bF)(m,{showIcons:[0,0,1,1,1],onDeleteItem:r.deleteItem,onRefreshTable:r.refreshTable,onExportExcel:r.exportExcel},null,8,["onDeleteItem","onRefreshTable","onExportExcel"]),(0,o.bF)(g,{selection:l.selectedItems,"onUpdate:selection":t[0]||(t[0]=e=>l.selectedItems=e),value:l.items,stripedRows:"",size:"small",metaKeySelection:l.metaKey,dataKey:"id",sortOrder:1,selectionMode:"multiple"},{empty:(0,o.k6)(()=>t[6]||(t[6]=[(0,o.eW)(" No existen datos para esta tabla. ",-1)])),loading:(0,o.k6)(()=>t[7]||(t[7]=[(0,o.eW)(" Cargando informacion.... ",-1)])),default:(0,o.k6)(()=>[(0,o.bF)(u,{selectionMode:"multiple",style:{width:"1%"}}),(0,o.bF)(u,{field:"date",header:"Fecha"},{body:(0,o.k6)(e=>[(0,o.eW)((0,i.v_)(e.data.date),1)]),_:1}),(0,o.bF)(u,{field:"egresoType.tipo",header:"Tipo"}),(0,o.bF)(u,{field:"egresoType.name",header:"Tipo de transaccion",style:{width:"20%"}}),(0,o.bF)(u,{field:"concept",header:"Concepto"}),(0,o.bF)(u,{field:"formaPago",header:"Forma de pago"}),(0,o.bF)(u,{header:"Cargo"},{body:(0,o.k6)(e=>[(0,o.Lk)("div",null,(0,i.v_)(r.formatCurrency(e.data.ammount)),1)]),_:1}),(0,o.bF)(u,{field:"fileName",header:"Archivo Adjunto"}),(0,o.bF)(h,{type:" footer"},{default:(0,o.k6)(()=>[(0,o.bF)(p,null,{default:(0,o.k6)(()=>[(0,o.bF)(u,{footer:"Totales:",colspan:4,footerStyle:"text-align:right"}),(0,o.bF)(u,null,{footer:(0,o.k6)(e=>t[8]||(t[8]=[])),_:1})]),_:1})]),_:1})]),_:1},8,["selection","value","metaKeySelection"])]),(0,o.bF)(V,{visible:l.showAdd,"onUpdate:visible":t[5]||(t[5]=e=>l.showAdd=e),modal:"",header:l.titulo,style:{width:"25rem"}},{default:(0,o.k6)(()=>[(0,o.Lk)("div",f,[(0,o.bF)(D,{initialValues:l.initialValues,resolver:r.resolver,validateOnValueUpdate:!1,validateOnBlur:!1,onSubmit:r.onFormSubmit,class:"flex flex-col gap-4 w-full sm:w-56"},{default:(0,o.k6)(a=>[(0,o.Lk)("div",v,[(0,o.bF)(b,{name:"date",showIcon:"",fluid:"",iconDisplay:"input",dateFormat:"dd M yy",modelValue:l.selectedDate,"onUpdate:modelValue":t[1]||(t[1]=e=>l.selectedDate=e),size:"small",showButtonBar:""},null,8,["modelValue"]),a.date?.invalid?((0,o.uX)(),(0,o.Wv)(C,{key:0,severity:"error",size:"small",variant:"simple"},{default:(0,o.k6)(()=>[(0,o.eW)((0,i.v_)(a.date.error.message),1)]),_:2},1024)):(0,o.Q3)("",!0)]),(0,o.bF)(_,{name:"formaPago",options:l.formaPagoOptions,optionLabel:"label",placeholder:"Forma de pago",fluid:"",style:{"margin-bottom":"10px","margin-top":"20px"},modelValue:l.selectedFormaPago,"onUpdate:modelValue":t[2]||(t[2]=e=>l.selectedFormaPago=e),size:"small"},{option:(0,o.k6)(e=>[(0,o.Lk)("div",T,[(0,o.Lk)("div",null,(0,i.v_)(e.option.label),1)])]),_:1},8,["options","modelValue"]),(0,o.bF)(_,{name:"egresoType",options:l.itemsEgresoTypes,optionLabel:"name",placeholder:"Tipo",fluid:"",style:{"margin-bottom":"10px","margin-top":"20px"},modelValue:l.selectedEgresoType,"onUpdate:modelValue":t[3]||(t[3]=e=>l.selectedEgresoType=e),size:"small"},{option:(0,o.k6)(e=>[(0,o.Lk)("div",k,[(0,o.Lk)("div",null,(0,i.v_)(e.option.tipo)+" - "+(0,i.v_)(e.option.name),1)])]),_:1},8,["options","modelValue"]),(0,o.Lk)("div",F,[(0,o.bF)(L,{name:"ammount",type:"number",placeholder:"Monto",fluid:"",size:"small"}),a.ammount?.invalid?((0,o.uX)(),(0,o.Wv)(C,{key:0,severity:"error",size:"small",variant:"simple"},{default:(0,o.k6)(()=>[(0,o.eW)((0,i.v_)(a.ammount.error.message),1)]),_:2},1024)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",A,[(0,o.bF)(L,{name:"concept",type:"text",placeholder:"Concepto",fluid:"",size:"small"}),a.concept?.invalid?((0,o.uX)(),(0,o.Wv)(C,{key:0,severity:"error",size:"small",variant:"simple"},{default:(0,o.k6)(()=>[(0,o.eW)((0,i.v_)(a.concept.error.message),1)]),_:2},1024)):(0,o.Q3)("",!0)]),(0,o.Lk)("div",x,[t[9]||(t[9]=(0,o.eW)(" Adjuntar archivo: ",-1)),(0,o.bF)(w,{mode:"basic",onSelect:e.onFileSelect,customUpload:"",auto:"",severity:"secondary",class:"p-button-outlined",style:{"margin-bottom":"20px"},maxFileSize:1e6,uploadLabel:"Abrir",accept:"application/pdf"},null,8,["onSelect"])]),(0,o.Lk)("div",E,[(0,o.bF)(c,{type:"button",label:"Cancelar",severity:"secondary",onClick:t[4]||(t[4]=e=>l.showAdd=!1),style:{"margin-top":"20px"}}),(0,o.bF)(c,{type:"submit",label:"Guardar",style:{"margin-left":"20px"}})])]),_:1},8,["initialValues","resolver","onSubmit"])])]),_:1},8,["visible","header"])],64)}a(8111),a(2489),a(1701);var _=a(144),L=a(1677),w=a(3691),D=a(373),V=a(4392),I=a(1838),S=a(6697),R=a(6498),B=a(7780),P=a(9532),U=a(6988),K=a(3076),O=a(3053),z=a(569),W=a(3830),M=a(211),N=a(3230),X=a(788),j={props:{selectedCondominio:{type:Object,default:null}},components:{DataTable:w.A,Column:D.A,ColumnGroup:V.A,Row:I.A,TableBar:L.A,Dialog:S.A,InputText:R.A,Button:g.A,Form:z.A,Select:b.A,DatePicker:B.A,FileUpload:P.A,Message:U.A,ConfirmPopup:K.A,Toast:O.A},data(){return{selectedLote:null,items:(0,_.KR)([]),selectedFormaPago:(0,_.KR)(),selectedEgresoType:(0,_.KR)(),titulo:(0,_.KR)(""),confirm:(0,M.S)(),toast:(0,W.d)(),selectedItems:(0,_.KR)([]),selectedDate:null,itemsEgresoTypes:(0,_.KR)([]),metaKey:(0,_.KR)(!0),items:(0,_.KR)([]),showAdd:(0,_.KR)(!1),newItem:(0,_.KR)(!1),initialValues:{id:0,tipo:0,name:"",date:null,ammount:0,concept:"",loteId:null},formaPagoOptions:[{label:"Transferencia bancaria",value:"TRANSFERENCIA"},{label:"Deposito bancario",value:"DEPOSITO_BANCARIO"},{label:"Efectivo",value:"EFECTIVO"},{label:"Tarjeta de credito",value:"TARJETA_CREDITO"},{label:"Tarjeta de debito",value:"TARJETA_DEBITO"},{label:"Cheque",value:"CHEQUE"}]}},methods:{async refreshTable(){try{this.selectedCondominio&&(this.items=(await d.A.getEgresosByCondominio(this.selectedCondominio.id)).data,this.itemsEgresoTypes=(await d.A.getTiposEgresosByCondominio(this.selectedCondominio.id)).data)}catch(e){console.error("Failed to fetch Egresos:",e),this.toast.add({severity:"error",summary:"Error de conexion con el servidor.",life:3e3})}},async updateEgreso(){try{return(await d.A.updateEgreso(this.initialValues)).data}catch(e){console.error("Failed to update Egresos:",e),this.toast.add({severity:"error",summary:"Error de conexion con el servidor.",life:3e3})}},async createEgreso(){try{return(await d.A.createEgreso(this.initialValues)).data}catch(e){console.error("Failed to create Egresos:",e),this.toast.add({severity:"error",summary:"Error de conexion con el servidor.",life:3e3})}},async deleteEgreso(e){try{await d.A.deleteEgreso(e),this.toast.add({severity:"info",summary:"Registros borrados",life:3e3}),this.selectedItems=null,await this.refreshTable()}catch(t){console.error("Failed to delete Egresos:",t),this.toast.add({severity:"error",summary:"Error de conexion con el servidor.",life:3e3})}},formatDate(e){const t=new Date(e);return t.toLocaleDateString("es-MX",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"})},formatDateShort(e){const t=new Date(e);return t.toLocaleDateString("es-MX",{day:"2-digit",month:"short",year:"numeric"})},formatCurrency(e){return"$ "+e.toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})},async addEgreso(){this.selectedCondominio?(this.titulo="Agregar egreso",this.initialValues.id=null,this.initialValues.tipo=1,this.initialValues.concept="",this.initialValues.ammount="",this.selectedDate=null,this.initialValues.date=this.formatDateShort(new Date),this.initialValues.type="ABONO",this.selectedType=null,this.showAdd=!0,this.newItem=!0):this.toast.add({severity:"error",summary:"Seleccione un condominio para agregar un abono.",life:3e3})},editItem(){1!=this.selectedItems.length?this.toast.add({severity:"error",summary:"Seleccione un elemento de la lista.",life:3e3}):(this.titulo="Actualizar cuota",this.initialValues=this.selectedItems[0],this.showAdd=!0,this.newItem=!1)},deleteItem(e){this.selectedItems&&0!==this.selectedItems.length?this.confirm.require({target:e.currentTarget,message:"Desea borrar el/los registros?",icon:"pi pi-info-circle",rejectProps:{label:"Cancelar",severity:"secondary",outlined:!0},acceptProps:{label:"Borrar",severity:"danger"},accept:()=>{for(const e of this.selectedItems)this.deleteTransaccionesLote(e.id),this.items=this.items.filter(t=>t.id!==e.id)},reject:()=>{}}):this.toast.add({severity:"error",summary:"Seleccione un elemento de la lista.",life:3e3})},resolver({values:e}){const t={};return e.tipo.id||(t.tipo=[{message:"El tipo es requerido."}]),e.concept||(t.concept=[{message:"El concepto es requerido."}]),e.date||(t.date=[{message:"La fecha es requerida."}]),e.ammount||(t.ammount=[{message:"El monto es requerido."}]),e.ammount<=0&&(t.ammount=[{message:"El monto debe ser mayor a cero"}]),this.initialValues.name=e.name,this.initialValues.concept=e.concept,this.initialValues.ammount=e.ammount,this.initialValues.date=e.date,this.initialValues.tipo=e.tipo,{errors:t}},async onFormSubmit({valid:e}){e&&(this.showAdd=!1,this.selectedItems=[],this.newItem?(this.initialValues.date=this.formatDateShort(this.selectedDate),this.initialValues.transactionType=this.selectedType,this.initialValues=await this.createTransaccionesLote(),this.refreshTable(),this.toast.add({severity:"success",summary:"Nueva transaccion agregada correctamente.",life:3e3})):(this.initialValues.date=this.formatDateShort(this.selectedDate),this.initialValues.transactionType=this.selectedType,this.initialValues.transactionType=selectedType,this.updateTransaccionesLote(),this.refreshTable(),this.toast.add({severity:"success",summary:"Transaccion actualizada correctamente.",life:3e3})))},exportExcel(){if(0===this.items.length)this.toast.add({severity:"warn",summary:"No hay datos para exportar.",life:3e3});else{const e=this.items.map(e=>({Fecha:e.date,Tipo:e.transactionType.tipo,Tipo_de_Transaccion:e.transactionType.name,Concepto:e.concept,Cargo:"CARGO"===e.transactionType.tipo?e.ammount:"",Abono:"ABONO"===e.transactionType.tipo?e.ammount:""})),t=N.Wp.json_to_sheet(e),a=N.Wp.book_new();N.Wp.book_append_sheet(a,t,"Transacciones por Lote");const o=N.M9(a,{bookType:"xlsx",type:"array"}),i=new Blob([o],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});(0,X.saveAs)(i,"Transacciones por Lote.xlsx")}}},watch:{selectedCondominio(e,t){this.refreshTable(),this.selectedItems=null,this.items=null}},mounted(){this.refreshTable()},computed:{total(){let e=0;if(this.items)for(let t of this.items)e+=t.ammount;return e}}},q=a(1241);const H=(0,q.A)(j,[["render",C]]);var G=H,Q={components:{Tabs:c.A,TabList:m.A,Tab:u.A,TabPanels:p.A,TabPanel:h.A,Button:g.A,Select:b.A,Egresos:G},data(){return{authStore:(0,n.n)(),selectedItem:null,condominiosList:[],userData:null,items:[{id:"0",label:"Egresos",icon:"pi pi-arrow-right"},{id:"1",label:"Balance",icon:"pi pi-sitemap"},{id:"2",label:"Cuotas",icon:"pi pi-file-export"},{id:"3",label:"Bitacora Acceso",icon:"pi pi-info-circle"}]}},methods:{async refreshTable(){if(this.userData)try{this.condominiosList=(await d.A.getCondominiosByUsr(this.userData.id)).data}catch(e){console.error("Failed to fetch getCondominiosByUsr:",e),this.toast.add({severity:"error",summary:"Error de conexion con el servidor.",life:3e3})}},async getUserData(){try{this.userData=this.authStore.getUserData()}catch(e){console.error("Failed to fetch getUserData:",e),this.toast.add({severity:"error",summary:"Error de conexion con el servidor.",life:3e3})}}},mounted(){this.getUserData(),this.refreshTable()}};const J=(0,q.A)(Q,[["render",r]]);var $=J}}]);
//# sourceMappingURL=797.2af5a7aa.js.map